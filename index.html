<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Stock Market Tracker</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="output.css" rel="stylesheet">
  </head>

  <body class="bg-gray-50 p-6">
    <header class="text-center bg-gray-800 text-white py-6">
      <h1 class="text-3xl font-bold">Stock Tracker Dashboard</h1>
    </header>

    <main class="p-6 max-w-5xl mx-auto">
      <!-- Dropdown Section -->
      <section class="mb-6 text-center">
        <h2 class="text-xl font-semibold mb-2">Select Trending Stock</h2>
        <div class="flex flex-col sm:flex-row justify-center items-center gap-4">
          <select id="stockDropdown" class="px-4 py-2 text-base w-72 border border-gray-300 rounded-md">
            <!-- Stock options will be dynamically populated -->
          </select>
          <button id="loadStockButton" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
            Load Stock
          </button>
        </div>
      </section>

      <!-- Search Section -->
      <section class="mb-6 flex flex-col sm:flex-row justify-center items-center gap-4">
        <input
          type="text"
          id="stockSearch"
          placeholder="Search for a stock (e.g., AAPL)"
          class="px-4 py-2 text-base border border-gray-300 rounded w-72"
        />
        <button id="searchButton" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
          Search
        </button>
      </section>

      <!-- Stock Info Section -->
      <section class="mb-8">
        <h2 class="text-xl font-semibold mb-2">Stock Information</h2>
        <div id="stockDetails" class="bg-white p-4 rounded shadow text-gray-700"></div>
      </section>

      <!-- Graph Section -->
      <section class="mb-8">
        <h2 class="text-xl font-semibold mb-4">Stock Price Graph</h2>
        <div class="bg-white p-4 rounded shadow">
          <canvas id="stockChart" class="w-full h-96"></canvas>
        </div>
      </section>

      <!-- Stock Table Section -->
      <section>
        <h2 class="text-xl font-semibold mb-4">Compare Stocks</h2>
        <div class="overflow-x-auto">
          <table class="min-w-full bg-white border border-gray-200 text-center rounded shadow">
            <thead class="bg-gray-100">
              <tr>
                <th class="py-2 px-4 border">Stock</th>
                <th class="py-2 px-4 border">Price</th>
                <th class="py-2 px-4 border">Change</th>
                <th class="py-2 px-4 border">Volume</th>
              </tr>
            </thead>
            <tbody id="stockTable" class="text-gray-700">
              <!-- Stock rows will be dynamically added here -->
            </tbody>
          </table>
        </div>
      </section>
    </main>
    <script>
      const apiKey = "BGRQ0GBUKRRPK9GC";
      const stockSearch = document.getElementById("stockSearch");
      const searchButton = document.getElementById("searchButton");
      const stockDetails = document.getElementById("stockDetails");
      const stockTable = document
        .getElementById("stockTable")
        .getElementsByTagName("tbody")[0];
      const ctx = document.getElementById("stockChart").getContext("2d");
      let stockChart;

      const stockDropdown = document.getElementById("stockDropdown");
      const loadStockButton = document.getElementById("loadStockButton");

      // Fetch stock data
      async function getStockData(stockSymbol) {
        const response = await fetch(
          `https://www.alphavantage.co/query?function=TIME_SERIES_DAILY&symbol=${stockSymbol}&apikey=${apiKey}`
        );
        const data = await response.json();
        console.log(data);
        return data["Time Series (Daily)"];
      }

      // Fetch top 10 trending stocks
      async function getTrendingStocks() {
        const response = await fetch(
          `https://www.alphavantage.co/query?function=TIME_SERIES_INTRADAY&symbol=IBM&interval=5min&apikey=${apiKey}`
        );
        const data = await response.json();
        // Mocking top 10 stocks as Alpha Vantage API does not directly provide top trending stocks.
        // Replace this part with an actual trending stocks API endpoint.
        const trendingStocks = [
          "AAPL",
          "GOOGL",
          "MSFT",
          "AMZN",
          "TSLA",
          "FB",
          "NFLX",
          "NVDA",
          "BABA",
          "INTC",
        ];
        return trendingStocks;
      }

      // Populate dropdown with trending stocks
      async function populateDropdown() {
        const trendingStocks = await getTrendingStocks();
        trendingStocks.forEach((stock) => {
          const option = document.createElement("option");
          option.value = stock;
          option.text = stock;
          stockDropdown.appendChild(option);
        });
      }

      // Display stock details
      function displayStockDetails(stockData, symbol) {
        const latestDate = Object.keys(stockData)[0];
        const latestData = stockData[latestDate];
        const price = latestData["4. close"];
        const volume = latestData["5. volume"];
        const change = (
          latestData["4. close"] -
          stockData[Object.keys(stockData)[1]]["4. close"]
        ).toFixed(2);

        stockDetails.innerHTML = `
        <h3>${symbol}</h3>
        <p>Price: $${price}</p>
        <p>Change: $${change}</p>
        <p>Volume: ${volume}</p>
    `;

        updateStockTable(symbol, price, change, volume);
      }

      // Update stock comparison table
      function updateStockTable(symbol, price, change, volume) {
        const newRow = stockTable.insertRow();
        newRow.innerHTML = `
        <td>${symbol}</td>
        <td>$${price}</td>
        <td>${change}</td>
        <td>${volume}</td>
    `;
      }

      // Display stock price graph
      function displayStockGraph(stockData) {
        const labels = Object.keys(stockData).slice(0, 30).reverse();
        const data = labels.map((date) => stockData[date]["4. close"]);

        if (stockChart) {
          stockChart.destroy();
        }

        stockChart = new Chart(ctx, {
          type: "line",
          data: {
            labels: labels,
            datasets: [
              {
                label: "Stock Price",
                data: data,
                borderColor: "rgba(75, 192, 192, 1)",
                borderWidth: 1,
                fill: false,
              },
            ],
          },
          options: {
            scales: {
              x: {
                beginAtZero: true,
              },
              y: {
                beginAtZero: false,
              },
            },
          },
        });
      }

      // Handle stock search
      searchButton.addEventListener("click", async () => {
        const stockSymbol = stockSearch.value.toUpperCase();
        const stockData = await getStockData(stockSymbol);

        if (stockData) {
          displayStockDetails(stockData, stockSymbol);
          displayStockGraph(stockData);
        } else {
          stockDetails.innerHTML = `<p>Stock symbol not found.</p>`;
        }
      });

      // Load stock from dropdown
      loadStockButton.addEventListener("click", async () => {
        const selectedStock = stockDropdown.value;
        const stockData = await getStockData(selectedStock);
        if (stockData) {
          displayStockDetails(stockData, selectedStock);
          displayStockGraph(stockData);
        } else {
          stockDetails.innerHTML = `<p>Stock data not available for ${selectedStock}.</p>`;
        }
      });

      // Initialize dropdown with trending stocks
      populateDropdown();
    </script>
   

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </body>
</html>
